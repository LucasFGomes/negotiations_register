{"version":3,"sources":["../../app-es6/controllers/NegotiationController.js"],"names":["NegotiationsService","Negotiation","NegotiationsList","Message","NegotiationsView","MessageView","Bind","DateHelper","NegotiationController","$","document","querySelector","bind","_inputDate","_inputQuantity","_inputValue","_currentOrder","_negotiationsList","_message","_negotiationsService","_init","toList","then","negotiations","forEach","add","negotiation","catch","text","error","setInterval","importNegotiations","event","preventDefault","_addNegotiation","register","message","_cleanForm","column","orderReverse","order","current","next","delete","empties","convertTextToDate","value","parseInt","parseFloat","focus","negotiationController","currentInstance"],"mappings":"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","file":"NegotiationController.js","sourcesContent":["import NegotiationsService from '../services/NegotiationsService';\r\n\r\nimport Negotiation from '../models/Negotiation';\r\nimport NegotiationsList from '../models/NegotiationsList';\r\nimport Message from '../models/Message';\r\n\r\nimport NegotiationsView from '../views/NegotiationsView';\r\nimport MessageView from '../views/MessageView';\r\n\r\nimport Bind from '../helpers/Bind';\r\nimport DateHelper from '../helpers/DateHelper';\r\n\r\nclass NegotiationController {\r\n\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document);\r\n    this._inputDate = $('#data');\r\n    this._inputQuantity = $('#quantidade');\r\n    this._inputValue = $('#valor');\r\n    this._currentOrder = '';\r\n\r\n    this._negotiationsList = new Bind(\r\n      new NegotiationsList(),\r\n      new NegotiationsView($('#negociacoesView')),\r\n      'add', 'empties', 'order', 'orderReverse'\r\n    );\r\n\r\n    this._message = new Bind(\r\n      new Message(),\r\n      new MessageView($('#mensagemView')),\r\n      'text'\r\n    );\r\n\r\n    this._negotiationsService = new NegotiationsService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  _init() {\r\n\r\n    this._negotiationsService.toList()\r\n      .then(negotiations =>\r\n        negotiations.forEach(negotiation => this._negotiationsList.add(negotiation))\r\n      )\r\n      .catch(error => this._message.text = error)\r\n\r\n    setInterval(() => {\r\n      this.importNegotiations();\r\n    }, 2000);\r\n  }\r\n\r\n  add(event) {\r\n    event.preventDefault();\r\n\r\n    let negotiation = this._addNegotiation();\r\n\r\n    this._negotiationsService.register(negotiation)\r\n      .then((message) => {\r\n        this._negotiationsList.add(negotiation);\r\n        this._message.text = message;\r\n        this._cleanForm();\r\n      })\r\n      .catch(error => this._message.text = error);\r\n\r\n  }\r\n\r\n  order(column) {\r\n    if (this._currentOrder == column) {\r\n      this._negotiationsList.orderReverse();\r\n    } else {\r\n      this._negotiationsList.order((current, next) => current[column] - next[column]);\r\n    }\r\n    this._currentOrder = column;\r\n  }\r\n\r\n  importNegotiations() {\r\n\r\n    this._negotiationsService.importNegotiations(this._negotiationsList.negotiations)\r\n      .then(negotiations => {\r\n        negotiations.forEach(negotiation => this._negotiationsList.add(negotiation));\r\n        // this._message.text = 'Negociações importadas com sucesso.'\r\n      })\r\n      .catch((error) => this._message.text = error);\r\n\r\n  }\r\n\r\n  deleteNegotiations() {\r\n\r\n    this._negotiationsService.delete()\r\n      .then(message => {\r\n        this._message.text = message;\r\n        this._negotiationsList.empties();\r\n        this._cleanForm();\r\n      })\r\n      .catch(error => this._message.text = error);\r\n\r\n  }\r\n\r\n  _addNegotiation() {\r\n    return new Negotiation(\r\n      DateHelper.convertTextToDate(this._inputDate.value),\r\n      parseInt(this._inputQuantity.value),\r\n      parseFloat(this._inputValue.value)\r\n    );\r\n  }\r\n\r\n  _cleanForm() {\r\n    this._inputDate.value = '';\r\n    this._inputQuantity.value = 1;\r\n    this._inputValue.value = 0.0;\r\n    this._inputDate.focus();\r\n  }\r\n\r\n}\r\n\r\nlet negotiationController = new NegotiationController();\r\n\r\nexport function currentInstance() {\r\n  return negotiationController;\r\n}"]}